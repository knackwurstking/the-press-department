(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerpolicy&&(r.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?r.credentials="include":s.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=n(s);fetch(s.href,r)}})();function f(){}function B(e){return e()}function O(){return Object.create(null)}function y(e){e.forEach(B)}function z(e){return typeof e=="function"}function j(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function M(e){return Object.keys(e).length===0}function P(e,t){e.appendChild(t)}function v(e,t,n){e.insertBefore(t,n||null)}function b(e){e.parentNode.removeChild(e)}function _(e){return document.createElement(e)}function X(e){return document.createTextNode(e)}function W(){return X(" ")}function F(e,t,n,i){return e.addEventListener(t,n,i),()=>e.removeEventListener(t,n,i)}function u(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function T(e){return Array.from(e.childNodes)}let m;function g(e){m=e}function U(){if(!m)throw new Error("Function called outside component initialization");return m}function D(e){U().$$.on_mount.push(e)}const d=[],L=[],R=[],G=[],H=Promise.resolve();let E=!1;function S(){E||(E=!0,H.then(C))}function N(e){R.push(e)}const x=new Set;let w=0;function C(){const e=m;do{for(;w<d.length;){const t=d[w];w++,g(t),Y(t.$$)}for(g(null),d.length=0,w=0;L.length;)L.pop()();for(let t=0;t<R.length;t+=1){const n=R[t];x.has(n)||(x.add(n),n())}R.length=0}while(d.length);for(;G.length;)G.pop()();E=!1,x.clear(),g(e)}function Y(e){if(e.fragment!==null){e.update(),y(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(N)}}const q=new Set;function K(e,t){e&&e.i&&(q.delete(e),e.i(t))}function J(e,t,n,i){const{fragment:s,on_mount:r,on_destroy:o,after_update:l}=e.$$;s&&s.m(t,n),i||N(()=>{const h=r.map(B).filter(z);o?o.push(...h):y(h),e.$$.on_mount=[]}),l.forEach(N)}function Q(e,t){const n=e.$$;n.fragment!==null&&(y(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function V(e,t){e.$$.dirty[0]===-1&&(d.push(e),S(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function Z(e,t,n,i,s,r,o,l=[-1]){const h=m;g(e);const a=e.$$={fragment:null,ctx:null,props:r,update:f,not_equal:s,bound:O(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(h?h.$$.context:[])),callbacks:O(),dirty:l,skip_bound:!1,root:t.target||h.$$.root};o&&o(a.root);let p=!1;if(a.ctx=n?n(e,t.props||{},(c,I,...$)=>{const A=$.length?$[0]:I;return a.ctx&&s(a.ctx[c],a.ctx[c]=A)&&(!a.skip_bound&&a.bound[c]&&a.bound[c](A),p&&V(e,c)),I}):[],a.update(),p=!0,y(a.before_update),a.fragment=i?i(a.ctx):!1,t.target){if(t.hydrate){const c=T(t.target);a.fragment&&a.fragment.l(c),c.forEach(b)}else a.fragment&&a.fragment.c();t.intro&&K(e.$$.fragment),J(e,t.target,t.anchor,t.customElement),C()}g(h)}class ee{$destroy(){Q(this,1),this.$destroy=f}$on(t,n){const i=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return i.push(n),()=>{const s=i.indexOf(n);s!==-1&&i.splice(s,1)}}$set(t){this.$$set&&!M(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const k=function(){const e={ROLLEN_ROUND:1,ROLLEN_GRIP:2,RIEMEN_ROUND:3,RIEMEN_GRIP:4,rbLength:1700,rbWidth:150,rbMaxCount:173,trockerLength1:150,trocknerAusgangLength:160,glRiemenCount:4};return e.assets=[{name:"rbAluBlockLeft",width:20,height:10,src:"assets/rb/engine/halterung/alu-block-left-20x10.png"},{name:"rbAluBlockRight",width:20,height:10,src:"assets/rb/engine/halterung/alu-block-right-20x10.png"},{name:"rolleLeft",width:6*6,height:296,src:"assets/RolleLeft_6x296.png"},{name:"rolleRight",width:6*6,height:296,src:"assets/RolleRight_6x296.png"},{name:"rbRiemen270x5",width:270,height:5*3,src:"assets/rb/engine/riemen/270x5.png"},{name:"rbRiemen290x5",width:290,height:5*3,src:"assets/rb/engine/riemen/290x5.png"},{name:"rbRiemen310x5",width:310,height:5*3,src:"assets/rb/engine/riemen/310x5.png"},{name:"rbRiemen430x5",width:430,height:5*3,src:"assets/rb/engine/riemen/430x5.png"},{name:"rbRiemen510x5",width:510,height:5*3,src:"assets/rb/engine/riemen/510x5.png"}],e.rb=[{name:"Trockner Eingang",engine:{count:15,type:e.ROLLEN_GRIP,side:"left"}},{name:"Ausrichter Eingang",engine:{count:14,type:e.ROLLEN_GRIP,side:"right"}},{name:"Rollen Bahn 5",engine:{count:14,type:e.ROLLEN_GRIP,side:"left"}},{name:"Rollen Bahn 4",engine:{count:22,type:e.ROLLEN_GRIP,side:"right"}},{name:"Rollen Bahn 3",engine:{count:22,type:e.ROLLEN_GRIP,side:"left"}},{name:"Rollen Bahn 2",engine:{count:22,type:e.ROLLEN_GRIP,side:"right"}},{name:"Rollen Bahn 1",engine:{count:22,type:e.ROLLEN_GRIP,side:"left"}},{name:"Wender",engine:{count:26,type:e.ROLLEN_GRIP,side:"right"}},{name:"Pressen \xDCbergangs Tisch",engine:{count:16,type:e.ROLLEN_GRIP,side:"right"}}],e.ta=[{name:"Gestell Rollen1",engine:{count:13,type:e.ROLLEN_GRIP}},{name:"Gestell Rollen 2",engine:{count:9,type:e.ROLLEN_GRIP}}],e.trockerAusgangRiemen={name:"Gestell Riemen",engine:{count:6,type:e.RIEMEN_ROUND}},e.pressenTisch={name:"Proben Tisch",engine:{count:6,type:e.RIEMEN_GRIP}},e}();class te{constructor(t,n,i,s,r,o,l,h){this.name=t,this.assets=h,this.side=n,this.count=i,this.x=s,this.y=r,this.width=o,this.height=l,this._frameNumber=0,this.hz=12,this.lastFrame=0-600/this.hz}drawRiemen(t,n){const i=this.assets[`rbRiemen${this.count*20-10}x5`];if(i)t.drawImage(i,0,5*(this._frameNumber%3),i.width,i.height/3,this.x+n,this.side==="left"?this.y+11:this.y+(this.assets.rolleLeft.height+(10-4-5)),i.width,5);else throw`missing assets: "rbRiemen${this.count*10}x5"`}drawAluBlockLeft(t,n){let i=this.assets.rbAluBlockLeft;t.drawImage(i,this.x+n,this.y,i.width,i.height)}drawAluBlockRight(t,n){let i=this.assets.rbAluBlockRight;t.drawImage(i,this.x+n,this.y+(this.assets.rbAluBlockLeft.height+(this.assets.rolleLeft.height-4)),i.width,i.height)}drawRolle(t,n){let i;this.side==="left"?i=this.assets.rolleLeft:i=this.assets.rolleRight;let s=6*this._frameNumber,r=0,o=6,l=i.height,h=this.y+8,a=i.width/6,p=i.height;t.drawImage(i,s,r,o,l,this.x+n,h,a,p)}draw(t,n){if(n-this.lastFrame>=600/this.hz){this.lastFrame=n;let i=this._frameNumber;try{this.drawRiemen(t,5)}catch{this._frameNumber=i}let s=-1;for(let r=0;r<this.count;r++){s+=1;let o=s*this.assets.rbAluBlockLeft.width;this.drawAluBlockLeft(t,o),this.drawAluBlockRight(t,o),this.drawRolle(t,o+7)}this._frameNumber+=1,this._frameNumber>5&&(this._frameNumber=0)}}}class ne{constructor(t,n){this._canvas=t,this.ctx=n,this.assets={},this._viewChanged=!1,this.view={pX:0,x:0,y:null,canvas:this._canvas,getY(){return this.y===null?this.canvas.height/2-321/2:this.y}},this.engines=[],this.pointer=!1,this.onpointerdown=null,this._pointerdown=i=>{this.view.pX=i.x,this.pointer=!0},this.onpointermove=null,this._pointermove=i=>{!this.pointer||(this.view.x-=this.view.pX-i.x,this.view.pX=i.x,this._viewChanged=!0)},this.onpointerup=null,this._pointerup=()=>{!this.pointer||(this.pointer=!1)},this.onpointercancel=null,this._pointercancel=i=>{!this.pointer||this._pointerup&&this._pointerup(i)},this.onpointerout=null,this._pointerout=i=>{!this.pointer||this._pointerup&&this._pointerup(i)},this._canvas.width=window.innerWidth-2,this._canvas.height=window.innerHeight-4,window.onresize=()=>{this._canvas.width=window.innerWidth-2,this._canvas.height=window.innerHeight-4,this._viewChanged=!0}}createEngine(t,n,i){let s=t.engine.count*this.assets.rbAluBlockLeft.width,r=this._canvas.height;return new te(t.name,t.engine.side,t.engine.count,n,i,s,r,this.assets)}buildEngines(){this.engines=[];let t=this.view.x;for(let n=0;n<k.rb.length;n++){let i=this.createEngine(k.rb[n],t,this.view.getY());this.engines.push(i),t+=i.width}}updatePosition(){let t=this.view.x;for(let n=0;n<this.engines.length;n++){let i=this.engines[n];i.x=t,i.y=this.view.getY(),t+=i.width}}handleUserInput(){this._canvas.onpointerdown=this._pointerdown,this._canvas.onpointermove=this._pointermove,this._canvas.onpointerup=this._pointerup,this._canvas.onpointercancel=this._pointercancel,this._canvas.onpointerout=this._pointerout}draw(t){this._viewChanged&&(this.ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this.updatePosition(),this._viewChanged=!1);for(let n of this.engines)n.draw(this.ctx,t)}async start(){this.buildEngines(),this.handleUserInput();const t=n=>{this.draw(n),requestAnimationFrame(t)};t(0)}}async function ie(e){const t=e.getContext("2d"),n=new ne(e,t),i=new Set;for(let s of k.assets)n.assets[s.name]=new Image(s.width,s.height),console.log("[DEBUG] load image:",s.src),n.assets[s.name].src=s.src,n.assets[s.name].onerror=r=>{console.warn("[WARNING] load game asset failed:",r.target.src)},i.add(n.assets[s.name].src),n.assets[s.name].onload=r=>{i.delete(r.target.src),i.size||n.start()};return n}function se(e){let t,n,i,s,r,o,l;return{c(){t=_("div"),n=_("input"),i=W(),s=_("main"),r=_("canvas"),u(n,"class","hz-rb svelte-tijnbm"),u(n,"type","number"),u(n,"min",0),n.value=re,u(t,"class","overlay svelte-tijnbm"),u(r,"class","svelte-tijnbm"),u(s,"class","svelte-tijnbm")},m(h,a){v(h,t,a),P(t,n),v(h,i,a),v(h,s,a),P(s,r),e[3](r),o||(l=F(n,"change",e[2]),o=!0)},p:f,i:f,o:f,d(h){h&&b(t),h&&b(i),h&&b(s),e[3](null),o=!1,l()}}}let re=12;function oe(e,t,n){let i,s;D(async()=>{n(1,s=await ie(i))});const r=l=>{for(let h of s.engines)h.hz=parseInt(l.currentTarget.value)};function o(l){L[l?"unshift":"push"](()=>{i=l,n(0,i)})}return[i,s,r,o]}class ae extends ee{constructor(t){super(),Z(this,t,oe,se,j,{})}}new ae({target:document.getElementById("app")});
